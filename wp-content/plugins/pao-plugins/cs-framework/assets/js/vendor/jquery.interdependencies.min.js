(function(d){function c(h){if(window.console&&window.console.log){console.log(h)}}function b(i,h){if(h[0]=="#"){if(h.indexOf(" ")<0){return d(h)}}return i.find(h)}var f={show:null,hide:null,log:false,checkTargets:true};function a(h,j,i){this.init(h,j,i)}d.extend(a.prototype,{init:function(h,j,i){this.controller=h;this.condition=j;this.value=i;this.rules=[];this.controls=[]},evalCondition:function(h,k,l,j,i){if(l=="=="){return this.checkBoolean(j)==this.checkBoolean(i)}else{if(l=="!="){return this.checkBoolean(j)!=this.checkBoolean(i)}else{if(l==">="){return Number(i)>=Number(j)}else{if(l=="<="){return Number(i)<=Number(j)}else{if(l==">"){return Number(i)>Number(j)}else{if(l=="<"){return Number(i)<Number(j)}else{if(l=="()"){return window[j](h,k,i)}else{if(l=="any"){return d.inArray(i,j.split(","))>-1}else{if(l=="not-any"){return d.inArray(i,j.split(","))==-1}else{throw new Error("Unknown condition:"+l)}}}}}}}}}},checkBoolean:function(h){switch(h){case true:case"true":case 1:case"1":h=true;break;case false:case"false":case 0:case"0":h=false;break}return h},checkCondition:function(i,h){if(!this.condition){return true}var j=i.find(this.controller);if(j.size()===0&&h.log){c("Evaling condition: Could not find controller input "+this.controller)}var k=this.getControlValue(i,j);if(h.log&&k===undefined){c("Evaling condition: Could not exctract value from input "+this.controller)}if(k===undefined){return false}k=this.normalizeValue(j,this.value,k);return this.evalCondition(i,j,this.condition,this.value,k)},normalizeValue:function(i,h,j){if(typeof h=="number"){return parseFloat(j)}return j},getControlValue:function(h,i){if((i.attr("type")=="radio"||i.attr("type")=="checkbox")&&i.size()>1){return i.filter(":checked").val()}if(i.attr("type")=="checkbox"||i.attr("type")=="radio"){return i.is(":checked")}return i.val()},createRule:function(h,k,i){var j=new a(h,k,i);this.rules.push(j);return j},include:function(h){if(!h){throw new Error("Must give an input selector")}this.controls.push(h)},applyRule:function(n,j,l){var h;if(l===undefined){h=this.checkCondition(n,j)}else{h=l}if(j.log){c("Applying rule on "+this.controller+"=="+this.value+" enforced:"+l+" result:"+h)}if(j.log&&!this.controls.length){c("Zero length controls slipped through")}var i=j.show||function(o){o.show()};var m=j.hide||function(o){o.hide()};var k=d.map(this.controls,function(p,o){var q=n.find(p);if(j.log&&q.size()===0){c("Could not find element:"+p)}return q});if(h){d(k).each(function(){if(j.log&&d(this).size()===0){c("Control selection is empty when showing");c(this)}i(this)});d(this.rules).each(function(){this.applyRule(n,j)})}else{d(k).each(function(){if(j.log&&d(this).size()===0){c("Control selection is empty when hiding:");c(this)}m(this)});d(this.rules).each(function(){this.applyRule(n,j,false)})}}});function g(){this.rules=[]}d.extend(g.prototype,{createRule:function(h,k,i){var j=new a(h,k,i);this.rules.push(j);return j},applyRules:function(k,h){var j;h=h||{};if(h.log){c("Starting evaluation ruleset of "+this.rules.length+" rules")}for(j=0;j<this.rules.length;j++){this.rules[j].applyRule(k,h)}},walk:function(){var i=[];function h(j){i.push(j);d(j.children).each(function(){h(this)})}d(this.rules).each(function(){h(this)});return i},checkTargets:function(j,h){var i=0;var k=this.walk();d(k).each(function(){if(j.find(this.controller).size()===0){throw new Error("Rule's controller does not exist:"+this.controller)}if(this.controls.length===0){throw new Error("Rule has no controls:"+this)}d(this.controls).each(function(){if(b(j,this)===0){throw new Error("Rule's target control "+this+" does not exist in context "+j.get(0))}i++})});if(h.log){c("Controller check ok, rules count "+k.length+" controls count "+i)}},install:function(h){d.deps.enable(d(document.body),this,h)}});var e={createRuleset:function(){return new g()},enable:function(l,i,h){h=h||{};if(h.checkTargets||h.checkTargets===undefined){i.checkTargets(l,h)}var j=this;if(h.log){c("Enabling dependency change monitoring on "+l.get(0))}var k=function(){i.applyRules(l,h)};var m=l.on?l.on("change.deps",null,null,k):l.live("change.deps",k);i.applyRules(l,h);return m}};d.deps=e})(jQuery);