(function(a){window.InlineShortcodeView_vc_tta_tabs=window.InlineShortcodeView_vc_tta_accordion.extend({render:function(){window.InlineShortcodeView_vc_tta_tabs.__super__.render.call(this);_.bindAll(this,"buildSortableNavigation","updateSortingNavigation");this.createTabs();_.defer(this.buildSortableNavigation);return this},createTabs:function(){var b=_.sortBy(vc.shortcodes.where({parent_id:this.model.get("id")}),function(c){return c.get("order")});_.each(b,function(c){this.sectionUpdated(c,true)},this)},defaultSectionTitle:window.i18nLocale.tab,addIcon:function(d,e){var f,c,b;if("true"===d.getParam("add_icon")){f=d.getParam("i_icon_"+d.getParam("i_type"));if(!_.isUndefined(f)){c="vc_tta-icon "+f;b='<i class="'+c+'"></i>'}if("right"===d.getParam("i_position")){e+=b}else{e=b+e}}return e},sectionUpdated:function(f,j){var c,h,l,e,i,b,g,d;d=false;l=f.get("id");h=this.$el.find(".vc_tta-tabs-container .vc_tta-tabs-list");c=h.find('[data-vc-target="[data-model-id='+l+']"]');i=f.getParam("title");if(c.length){e='<span class="vc_tta-title-text">'+i+"</span>";e=this.addIcon(f,e);c.html(e)}else{var k;e='<span class="vc_tta-title-text">'+i+"</span>";e=this.addIcon(f,e);k=a('<li class="vc_tta-tab" data-vc-target-model-id="'+l+'" data-vc-tab><a href="javascript:;" data-vc-use-cache="false" data-vc-tabs data-vc-target="[data-model-id='+l+']" data-vc-container=".vc_tta">'+e+"</a></li>");if(true!==j){b=_.pluck(_.sortBy(vc.shortcodes.where({parent_id:this.model.get("id")}),function(m){return m.get("order")}),"id");g=b.indexOf(f.get("id"))-1;if(g>-1&&h.find("[data-vc-tab]:eq("+g+")").length){k.insertAfter(h.find("[data-vc-tab]:eq("+g+")"));d=true}}!d&&k.appendTo(h);if(f.get("isActiveSection")){k.addClass(this.activeClass)}}this.buildPagination()},getNextTab:function(e){var f,c,b,d;d=this.$el.find(".vc_tta-tabs-container .vc_tta-tabs-list").children();f=d.length-1;c=e.index();if(c!==f){b=d.eq(c+1)}else{b=d.eq(c-1)}return b},removeSection:function(e){var c,b,d;c=this.$el.find('.vc_tta-tabs-container .vc_tta-tabs-list [data-vc-target="[data-model-id='+e+']"]').parent();d=c.hasClass(this.activeClass);if(d){b=this.getNextTab(c);vc.frame_window.jQuery(b).find("[data-vc-target]").trigger("click")}c.remove();this.buildPagination()},buildSortableNavigation:function(){if(!vc_user_access().shortcodeEdit(this.model.get("shortcode"))){return}this.$el.find(".vc_tta-tabs-container .vc_tta-tabs-list").sortable({items:".vc_tta-tab",forcePlaceholderSize:true,placeholder:"vc_tta-tab vc_placeholder-tta-tab",helper:this.renderSortingHelper,start:function(b,c){c.placeholder.width(c.item.width())},over:function(b,c){c.placeholder.css({maxWidth:c.placeholder.parent().width()});c.placeholder.removeClass("vc_hidden-placeholder")},update:this.updateSortingNavigation})},updateSorting:function(b,c){window.InlineShortcodeView_vc_tta_tabs.__super__.updateSorting.call(this,b,c);this.updateTabsPositions(this.getPanelsList())},updateSortingNavigation:function(){var b,c;c=this;b=this.$el.find(".vc_tta-tabs-list");b.find("> .vc_tta-tab").each(function(){var d,f,e;e=a(this).removeAttr("style");f=e.data("vcTargetModelId");d=vc.shortcodes.get(f);d.save({order:c.getIndex(e)},{silent:true})});this.updatePanelsPositions(b)},updateTabsPositions:function(e){var b,d,c;b=this.$el.find(".vc_tta-tabs-list");if(b.length){d=[];c=e.sortable("toArray",{attribute:"data-model-id"});_.each(c,function(f){d.push(b.find('[data-vc-target-model-id="'+f+'"]'))},this);b.prepend(d)}this.buildPagination()},updatePanelsPositions:function(b){var d,c,e;e=this.getPanelsList();d=[];c=b.sortable("toArray",{attribute:"data-vc-target-model-id"});_.each(c,function(f){d.push(e.find('[data-model-id="'+f+'"]'))},this);e.prepend(d);this.buildPagination()},renderSortingHelper:function(e,c){var d,f,b;d=c;f=c.width()+1;b=c.height();d.width(f);d.height(b);return d},buildPagination:function(){var b;this.removePagination();b=this.model.get("params");if(!_.isUndefined(b.pagination_style)&&b.pagination_style.length){if("top"===b.tab_position){this.$el.find(".vc_tta-panels-container").append(this.getPaginationList())}else{this.getPaginationList().insertBefore(this.$el.find(".vc_tta-container .vc_tta-panels"))}}}})})(window.jQuery);