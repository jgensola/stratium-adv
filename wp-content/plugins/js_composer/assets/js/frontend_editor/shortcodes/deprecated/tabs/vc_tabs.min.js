(function(a){vc.cloneMethod_vc_tab=function(c,b){c.params=_.extend({},c.params);c.params.tab_id=vc_guid()+"-cl";if(!_.isUndefined(b.get("active_before_cloned"))){c.active_before_cloned=b.get("active_before_cloned")}return c};window.InlineShortcodeView_vc_tabs=window.InlineShortcodeView_vc_row.extend({events:{"click > :first > .vc_empty-element":"addElement","click > :first > .wpb_wrapper > .ui-tabs-nav > li":"setActiveTab"},already_build:false,active_model_id:false,$tabsNav:false,active:0,render:function(){_.bindAll(this,"stopSorting");this.$tabs=this.$el.find("> .wpb_tabs");window.InlineShortcodeView_vc_tabs.__super__.render.call(this);this.buildNav();return this},buildNav:function(){var b=this.tabsControls();this.$tabs.find('> .wpb_wrapper > .vc_element[data-tag="vc_tab"]').each(function(c){a("li:eq("+c+")",b).attr("data-m-id",a(this).data("model-id"))})},changed:function(){if(this.allowAddControlOnEmpty()&&0===this.$el.find(".vc_element[data-tag]").length){this.$el.addClass("vc_empty").find("> :first > div").addClass("vc_empty-element")}else{this.$el.removeClass("vc_empty").find("> :first > div").removeClass("vc_empty-element")}this.setSorting()},setActiveTab:function(c){var b=a(c.currentTarget);this.active_model_id=b.data("m-id")},tabsControls:function(){return this.$tabsNav?this.$tabsNav:this.$tabsNav=this.$el.find(".wpb_tabs_nav")},buildTabs:function(b){if(b){this.active_model_id=b.get("id");this.active=this.tabsControls().find("[data-m-id="+this.active_model_id+"]").index()}if(false===this.active_model_id){var c=this.tabsControls().find("li:first");this.active=c.index();this.active_model_id=c.data("m-id")}if(!this.checkCount()){vc.frame_window.vc_iframe.buildTabs(this.$tabs,this.active)}},checkCount:function(){return this.$tabs.find('> .wpb_wrapper > .vc_element[data-tag="vc_tab"]').length!=this.$tabs.find("> .wpb_wrapper > .vc_element.vc_vc_tab").length},beforeUpdate:function(){this.$tabs.find(".wpb_tabs_heading").remove();vc.frame_window.vc_iframe.destroyTabs(this.$tabs)},updated:function(){window.InlineShortcodeView_vc_tabs.__super__.updated.call(this);this.$tabs.find(".wpb_tabs_nav:first").remove();this.buildNav();vc.frame_window.vc_iframe.buildTabs(this.$tabs);this.setSorting()},rowsColumnsConverted:function(){_.each(vc.shortcodes.where({parent_id:this.model.get("id")}),function(b){b.view.rowsColumnsConverted&&b.view.rowsColumnsConverted()})},addTab:function(c){if(this.updateIfExistTab(c)){return false}var d=this.buildControlHtml(c),b;if(c.get("cloned")&&(b=this.tabsControls().find("[data-m-id="+c.get("cloned_from").id+"]")).length){if(!c.get("cloned_appended")){d.appendTo(this.tabsControls());c.set("cloned_appended",true)}}else{d.appendTo(this.tabsControls())}this.changed();return true},cloneTabAfter:function(b){this.$tabs.find("> .wpb_wrapper > .wpb_tabs_nav > div").remove();this.buildTabs(b)},updateIfExistTab:function(b){var c=this.tabsControls().find("[data-m-id="+b.get("id")+"]");if(c.length){c.attr("aria-controls","tab-"+b.getParam("tab_id")).find("a").attr("href","#tab-"+b.getParam("tab_id")).text(b.getParam("title"));return true}return false},buildControlHtml:function(b){var d=b.get("params"),c=a('<li data-m-id="'+b.get("id")+'"><a href="#tab-'+b.getParam("tab_id")+'"></a></li>');c.data("model",b);c.find("> a").text(b.getParam("title"));return c},addElement:function(b){b&&b.preventDefault();new vc.ShortcodesBuilder().create({shortcode:"vc_tab",params:{tab_id:vc_guid()+"-"+this.tabsControls().find("li").length,title:this.getDefaultTabTitle()},parent_id:this.model.get("id")}).render()},getDefaultTabTitle:function(){return window.i18nLocale.tab},setSorting:function(){if(this.hasUserAccess()){vc.frame_window.vc_iframe.setTabsSorting(this)}},stopSorting:function(b,c){this.tabsControls().find("> li").each(function(e,f){var d=a(this).data("model");d.save({order:e},{silent:true})})},placeElement:function(d,c){var b=vc.shortcodes.get(d.data("modelId"));if(b&&b.get("place_after_id")){d.insertAfter(vc.$page.find("[data-model-id="+b.get("place_after_id")+"]"));b.unset("place_after_id")}else{d.insertAfter(this.tabsControls())}this.changed()},removeTab:function(c){if(1===vc.shortcodes.where({parent_id:this.model.get("id")}).length){return this.model.destroy()}var d=this.tabsControls().find("[data-m-id="+c.get("id")+"]"),b=d.index();if(this.tabsControls().find("[data-m-id]:eq("+(b+1)+")").length){vc.frame_window.vc_iframe.setActiveTab(this.$tabs,(b+1))}else{if(this.tabsControls().find("[data-m-id]:eq("+(b-1)+")").length){vc.frame_window.vc_iframe.setActiveTab(this.$tabs,(b-1))}else{vc.frame_window.vc_iframe.setActiveTab(this.$tabs,0)}}d.remove()},clone:function(b){_.each(vc.shortcodes.where({parent_id:this.model.get("id")}),function(c){c.set("active_before_cloned",this.active_model_id===c.get("id"))},this);window.InlineShortcodeView_vc_tabs.__super__.clone.call(this,b)}})})(window.jQuery);